# 向量数据库

| 数据库       | 语言        | 特点                                                                   | 缺陷                  | 星数                                                      | 
|-----------|-----------|----------------------------------------------------------------------|---------------------|---------------------------------------------------------|
| Faiss     | C++/Py    | 专注相似度搜索和密集向量聚类<br>支持IVF, PQ, HNSW等索引结构<br>适用人脸/指纹/基因比对、法律或学术小模型相似性搜索 | 并非完整数据库系统，缺乏分布式部署支持 | 34K [Github](https://github.com/facebookresearch/faiss) |
| Milvus    | Go/Py/C++ | 超大规模向量数据库<br>适用电商推荐系统、图像搜索、推荐系统、自然语言处理、化学结构搜索                        | 硬件要求高               | 34K [Github](https://github.com/milvus-io/milvus)       |
| Qdrant    | Rust      |                                                                      |                     | 23K [Github](https://github.com/qdrant/qdrant)          |
| Typesense | C++       |                                                                      |                     | 22K [Github](https://github.com/typesense/typesense)    |
| Chroma    | Py        | 简单，可在笔记本上使用<br>适用NLP, 小数据集, 学习                                       | 功能简单，无法满足高并发        | 19K [Github](https://github.com/chroma-core/chroma)      |
| Weaviate  | Go        | 图数据库，提供GraphQL-Based API<br>适合智能问答、数据分类和企业资源规划                       |                     | 13K [Github](https://github.com/weaviate/weaviate)      |
| Pipecone  |           | 适合实时推荐、电商搜索、社交内容过滤                                                   |                     |                                                         |



| 数据库           | 模块/扩展     | 向量功能             |
|---------------|-----------|------------------|
| Redis         | Search 模块 | 向量搜索             |
| PostgreSQL    | pgvector  | 向量搜索、cosine相似度测量 |
| Elasticsearch |           | 向量搜索、结构化搜索、实时分析  |


## Faiss
Faiss (Facebook AI Similarity Search) 使用C++编写，专注于相似度检索和密集向量聚类，对10亿级索引可以做到毫秒级检索。

Faiss 通过将候选向量建立索引方式，加速向量TopK相似度搜索。利用索引检索并非精确检索，属于模糊检索，因此会损失一定精度，我们使用召回率来表示模糊检索相对于精确检索的损失。

Faiss 构建TopK工作流程：
1. 得到向量库
2. 用 faiss 构建 index，并将向量添加进 index
3. 使用 faiss index 检索

Faiss 仅支持32位浮点数，因此不支持降低浮点数来减少内存占用。如果有上亿数据，无法放入内存，则需要分布式方式all reduce合并索引，而Faiss缺乏分布式支持，需要自己找分布式解决方案。

### Faiss 索引类型
> 倒排检索：利用关键词来检索文档。大模型下，关键词远比文档量少，因此可以减速检索时间。

| 索引                 | 优点                                            | 缺点          | 适用场景          |
|--------------------|-----------------------------------------------|-------------|---------------|
| Flat 暴力检索          | 召回率最高（最准确）                                    | 占用内存大、速度慢   | 向量候选50万以内     |
| IVFx Flat 倒排暴力检索   | 比Flat快                                        | 并不是很快       | 向量候选100万以内    |
| PQx 乘积量化           | 将一个向量切成x段，每段检索结果交集TopK                        | 召回率低        | 内存小，不在意召回率    |
| **IVFxPQy 倒排乘积量化** | 利用PQx改进IVF K-means                            |             | 工业大量使用，超大规模数据 |
| LSH 局部敏感哈希         | 训练快、索引占内存小                                    | 召回率低        | 内存小，离线检索      |
| HNSWx              | 图索引，检索极快，10亿级秒出，召回率媲美Flat，可达97%，时间复杂度log-logN | 建索引慢、占用内存极大 | 内存大           |

102万数据，top-k 个数：10~50词

| 算法      | 召回 | 耗时 | 计算方式        |
|---------|----|----|-------------|
| FlatL2  | 优  | 高  | 欧氏距离精准计算    |
| FlatIP  | 优  | 高  | 向量夹角余弦值精准计算 |
| HNSW    | 高  | 低  | 基于图索引       |
| IVFxPQy | 较高 | 低  | 两次量化        |
| PQx     | 高  | 较高 | 乘积量化        |
| LSH     | 低  | 低  | 局部敏感哈希      |


| 算法              | 召回    | 耗时     | 内存    | 构建时间 |
|-----------------|-------|--------|-------|------|
| HNSW64 (候选1)    | 97.4% | <2.5ms | 842MB | 246s |
| IVF50PQ64 (候选2) | 73.4% | <3ms   | 112MB | 52s  |
| IVF100PQ16      | 69.3% | 6ms    | 65MB  | 436s |

召回率计算方法：暴力检索结果位label，用模糊检索结果与label取交集后除以label数目。召回率 = (result ∩ label) / label * 100%

## Milvus
Milvus 由中国Zilliz公司开发，构建在 Faiss、HNSW、DiskANN、SCANN 等流行的向量搜索库之上，专为在包含数百万、数十亿甚至数万亿向量的密集向量数据集上进行相似性搜索而设计。

### Milvus 索引类型
| 索引         | 优点    | 缺点 | 适用场景 |
|------------|-------|----|------|
| Faiss IVF  |       |    |      |
| Milvus IVF | 自研    |    |      |
| Faiss HNSW |       |    |      | 
| Milvus NSG | 自研图索引 |    |      |
| 微软 SPTAG   |       |    |      |


### Knowhere
Knowhere 是 Milvus 的核心向量执行引擎，它集成了多个向量相似性搜索库，包括Faiss、Hnswlib和Annoy。Knowhere 的设计还支持异构计算。它可以控制在哪个硬件（CPU 或 GPU）上执行索引构建和搜索请求。
Milvus 中的计算主要涉及向量和标量操作。Knowhere 只处理向量索引的操作符。在 Knowhere 中，用于训练的数据和用于搜索的数据是相同的。Knowhere 会对一个数据段中的所有数据进行训练，然后插入所有训练过的数据并为它们建立索引。


## Chroma