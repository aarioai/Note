# 向量数据库

| 数据库       | 语言        | 特点                                                        | 缺陷                  | 星数                                                      | 
|-----------|-----------|-----------------------------------------------------------|---------------------|---------------------------------------------------------|
| Faiss     | C++/Py    | 专注相似度搜索和密集向量聚类<br>支持IVF, PQ, HNSW等索引结构<br>适用法律或学术小模型相似性搜索 | 并非完整数据库系统，缺乏分布式部署支持 | 34K [Github](https://github.com/facebookresearch/faiss) |
| milvus    | Go/Py/C++ | 超大规模向量数据库<br>适用电商推荐系统、图像搜索、推荐系统、自然语言处理、化学结构搜索             | 硬件要求高               | 34K [Github](https://github.com/milvus-io/milvus)       |
| qdrant    | Rust      |                                                           |                     | 23K [Github](https://github.com/qdrant/qdrant)          |
| typesense | C++       |                                                           |                     | 22K [Github](https://github.com/typesense/typesense)    |
| chroma    | Py        | 简单<br>适用NLP, 小数据集, 学习                                     | 功能简单，无法满足高并发        | 19K [Github](https://github.com/weaviate/weaviate)      |
| weaviate  | Go        |                                                           |                     | 13K [Github](https://github.com/weaviate/weaviate)      |


| 数据库           | 模块/扩展     | 向量功能            |
|---------------|-----------|-----------------|
| Redis         | Search 模块 | 向量搜索            |
| PostgreSQL    | pgvector  | 向量搜索、cosin相似度测量 |
| Elasticsearch |           | 向量搜索、结构化搜索、实时分析 |


## Faiss
Faiss (Facebook AI Similarity Search) 使用C++编写，专注于相似度检索和密集向量聚类，对10亿级索引可以做到毫秒级检索。

Faiss 通过将候选向量建立索引方式，加速向量TopK相似度搜索。利用索引检索并非精确检索，属于模糊检索，因此会损失一定精度，我们使用召回率来表示模糊检索相对于精确检索的损失。

Faiss 构建TopK工作流程：
1. 得到向量库
2. 用 faiss 构建 index，并将向量添加进 index
3. 使用 faiss index 检索

### Faiss 索引类型
> 倒排检索：利用关键词来检索文档。大模型下，关键词远比文档量少，因此可以减速检索时间。

| 索引                 | 优点                                              | 缺点          | 适用场景          |
|--------------------|-------------------------------------------------|-------------|---------------|
| Flat 暴力检索          | 召回率最高（最准确）                                      | 占用内存大、速度慢   | 向量候选50万以内     |
| IVFx Flat 倒排暴力检索   | 比Flat快                                          | 并不是很快       | 向量候选100万以内    |
| PQx 乘积量化           | 将一个向量切成x段，每段检索结果交集TopK                          | 召回率低        | 内存小，不在意召回率    |
| **IVFxPQy 倒排乘积量化** | 利用PQx改进IVF K-means                              |             | 工业大量使用，超大规模数据 |
| LSH 局部敏感哈希         | 训练快、索引占内存小                                      | 召回率低        | 内存小，离线检索      |
| HNSWx              | 图索引改进，检索极快，10亿级秒出，召回率媲美Flat，可达97%，时间复杂度log-logN | 建索引慢、占用内存极大 | 内存大           |

102万数据，top-k 个数：10~50词

| 算法      | 召回 | 耗时 | 计算方式        |
|---------|----|----|-------------|
| FlatL2  | 优  | 高  | 欧氏距离精准计算    |
| FlatIP  | 优  | 高  | 向量夹角余弦值精准计算 |
| HNSW    | 高  | 低  | 基于图索引       |
| IVFxPQy | 较高 | 低  | 两次量化        |
| PQx     | 高  | 较高 | 乘积量化        |
| LSH     | 低  | 低  | 局部敏感哈希      |


| 算法              | 召回    | 耗时     | 内存    | 构建时间 |
|-----------------|-------|--------|-------|------|
| HNSW64 (候选1)    | 97.4% | <2.5ms | 842MB | 246s |
| IVF50PQ64 (候选2) | 73.4% | <3ms   | 112MB | 52s  |
| IVF100PQ16      | 69.3% | 6ms    | 65MB  | 436s |
 